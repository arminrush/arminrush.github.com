---
title: linux单机性能测量
layout: post
category: linux
splitor: <!--more-->
---

sar（System Activity Reporter) 是后台进程sadc的现实工具，安装sysstat的包后，sadc就会自动从内核收集报告并保存。

sar能查看过去的信息，也能查看当前的信息。
<!--more-->
## 查看过去的统计信息 sar -f

sar将统计信息写入文件，保存在/var/log/sa目录下,可以通过-f 查看特定某一天某一天的文件。文件名的规则为 ‘sa日期天’，例如 24号， 就是sa24。

```
sar -f /var/log/sa/sa24
Linux 2.6.32-279.el6.x86_64     2016年01月24日     _x86_64_    (4 CPU)

00时00分01秒     CPU     %user     %nice   %system   %iowait    %steal     %idle
00时10分01秒     all      1.52      0.00      0.27      0.01      0.00     98.20
00时20分01秒     all      0.78      0.00      0.16      0.01      0.00     99.05
00时30分01秒     all      0.18      0.00      0.09      0.00      0.00     99.73
00时40分01秒     all      0.13      0.00      0.07      0.00      0.00     99.80
00时50分01秒     all      0.16      0.00      0.08      0.00      0.00     99.76
01时00分01秒     all      0.10      0.00      0.07      0.00      0.00     99.83
01时10分01秒     all      0.07      0.00      0.05      0.00      0.00     99.88

```

统计信息默认保存7天，要保留更长的时间需要修改配置文件（32位 /usr/lib/sa/sa2 64位/usr/lib64/sa/sa2)。

## 周期性的查看当前的数据

只需要加上数值参数， 如 sar 1 3， 意思是 1秒一次，采样3次

```
$ sar 1 3
Linux 2.6.32-279.el6.x86_64     2016年01月26日     _x86_64_    (4 CPU)

21时22分33秒     CPU     %user     %nice   %system   %iowait    %steal     %idle
21时22分34秒     all      1.50      0.00      0.50      0.00      0.00     97.99
21时22分35秒     all      2.26      0.00      0.25      0.00      0.00     97.49
21时22分36秒     all      0.75      0.00      0.25      0.00      0.00     98.99
平均时间:     all      1.51      0.00      0.33      0.00      0.00     98.16
```

## 查看CPU使用率 sar -u

``` 
$ sar -u 1 3
Linux 2.6.32-279.el6.x86_64     2016年01月26日     _x86_64_    (4 CPU)

21时23分47秒     CPU     %user     %nice   %system   %iowait    %steal     %idle
21时23分48秒     all      2.26      0.00      0.25      0.00      0.00     97.49
21时23分49秒     all      1.25      0.00      0.25      0.00      0.00     98.50
21时23分50秒     all      0.50      0.00      0.50      0.00      0.00     99.
```

 * CPU：all 表示统计信息为所有 CPU 的平均值。
 * %user：用户级别运行使用 CPU 比例
 * %nice：通过nice改变了进程调度优先级的进程，在用户级别，所占用 CPU 时间比例
 * %system：系统级别下CPU时间的比例
 * %iowait：等待I/O所占用 CPU 时间比例
 * %steal：利用Xen等操作系统虚拟化技术时，等待其他虚拟CPU计算占用的时间比例
 * %idle：CPU 空闲时间占用 CPU时间比例

## 查看平均负载 sar -r


```
$ sar -q 1 3
Linux 2.6.32-279.el6.x86_64     2016年01月26日     _x86_64_    (4 CPU)

21时30分01秒   runq-sz  plist-sz   ldavg-1   ldavg-5  ldavg-15
21时30分02秒         0       464      0.02      0.01      0.00
21时30分03秒         0       464      0.02      0.01      0.00
21时30分04秒         0       464      0.02      0.01      0.00
平均时间:         0       464      0.02      0.01      0.00
```

 * runq-sz 运行队列中的进程数
 * plist-sz 系统上的进程数
 * ldavg-1 最近1分钟系统的负载
 * ldavg-5 最近5分钟系统的负载
 * ldavg-15 最近15分钟系统的负载

## 查看内存使用情况 sar -r

```
$ sar -r 1 3
Linux 2.6.32-279.el6.x86_64     2016年01月26日     _x86_64_    (4 CPU)

21时37分30秒 kbmemfree kbmemused  %memused kbbuffers  kbcached  kbcommit   %commit
21时37分31秒    139836   7921892     98.27    124120   1934232   5944584     36.54
21时37分32秒    139836   7921892     98.27    124120   1934232   5944584     36.54
21时37分33秒    139572   7922156     98.27    124120   1934248   5944584     36.54
平均时间:    139748   7921980     98.27    124120   1934237   5944584     36.54
```

 * kbmemfree 空闲物理内存大小
 * kbmemused 已使用的物理内存大小
 * %memused 物理内存使用率
 * kbbuffers 内核中作为缓冲区使用的物理内存大小
 * kbcached  内核中作为缓存使用的物理内存大小， 对文件的页面缓存大小
 * kbcommit 保证当前系统所需要的内存,即为了确保不溢出而需要的内存(RAM+swap)
 * %commit kbcommit在总内存的比例

 ## 查看交换空间情况 sar -S

 ```
 $ sar -S 1 3
Linux 2.6.32-279.el6.x86_64     2016年01月26日     _x86_64_    (4 CPU)

21时48分07秒 kbswpfree kbswpused  %swpused  kbswpcad   %swpcad
21时48分08秒   8108980     99396      1.21     10848     10.91
21时48分09秒   8108980     99396      1.21     10848     10.91
21时48分10秒   8108980     99396      1.21     10848     10.91
平均时间:   8108980     99396      1.21     10848     10.91
```

 * kbswpfree 空闲
 * kbswpused 已使用的大小
 * %swpused 已使用的比例
 * kbswpcad 交换区缓存的大小
 * %swpcad 交换区缓存的大小比例

 ## 查看页面交换发生的情况 sar -W

 ```
 sar -W 1 3
Linux 2.6.32-279.el6.x86_64    2016年01月26日     _x86_64_    (4 CPU)

21时56分22秒  pswpin/s pswpout/s
21时56分23秒      0.00      0.00
21时56分24秒      0.00      0.00
21时56分25秒      0.00      0.00
平均时间:      0.00      0.00
```

 * pswpin/s 一秒内换入页面数
 * pswpout/s 一秒内换出页面数
